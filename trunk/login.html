<html>
<head>
	<title>Login</title>
	<link href="./css/login-box.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div id="login-box">
		<h1>Login</h1>
		<form>
			<div id="error_msg"></div><br/>
			<div id="login-box-name" >Name: </div><div id="login-box-field"><input type="text" class="form-login" id="user_name" /></div>
			<div id="login-box-name">Password: </div><div id="login-box-field"><input type="password" class="form-login" id="password" /></div>
			<input type="submit" id="login" />
		</form>
	</div>

	<!-- 
		Javascript section
	-->
	<script type="text/javascript" src="./scripts/jquery-1.7.min.js"></script>
	<script type="text/javascript" src="./scripts/common.js"></script>
	<script type="text/javascript">
		
		ajaxSetup();
		
		// Check whether the user already logged in and redirect to shopping page if so.
		$.getJSON("./login.php?method=getLoginInfo", function(resp) {
			if (resp.login) {
				$("body").html("Welcome back, " + resp.user_id + ". Redirecting you to the storefront in 2 seconds.");
				setTimeout(function() {
					window.location = "storefront.html";
				}, 2000);
			}
		});
		
		// Perform user login. Redirect to storefront if succeed.
		$("#login").click(function(e) {
			e.preventDefault(); // Cancel default submit behaviour.
			
			$.getJSON("./login.php?method=login",
			{
				user_id: $("#user_name").val(),
				password: $("#password").val()
			},
			function(resp) {
				if (resp) {
					window.location = "storefront.html";
				}
				else {
					$("#error_msg").html("Login Failed");
				}
			});
		});

	</script>
</body>
</html>