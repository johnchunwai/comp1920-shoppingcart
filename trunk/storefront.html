<html>
<head>
<script type="text/javascript" src="./jquery/jquery-1.7.min.js"></script>
<script type="text/javascript" src="./jquery/common.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		
		ajaxSetup();
		
		// Check whether the user already logged in and redirect to login page if not.
		$.getJSON("./login.php?method=getLoginInfo", function(resp) {
			if (!resp.login) {
				window.location = "login.html";
			}
			else {
				$(".user_id").html(resp.user_id);
			}
		});
		
		// Populate the product lists.
		updateProductCatalogue();
		
		// Present the product catalog for purchase.
		catalog = '<table>';
		$.each(window.products, function(id, details) {
			catalog += '<tr>';
			catalog += '<td><img src="' + details.prod_image + '"/></td>';
			catalog += '<td>' + details.prod_name + '</td>';
			catalog += '<td>' + details.prod_desc + '</td>';
			catalog += '<td><select id="' + id + '_qty">';
			var i;
			for (i = 1; i <= 10; i++) {
				catalog += '<option value="' + i + '">' + i + '</option>';
			}
			catalog += '</select></td>';
			catalog += '<td><input type="button" class="button" id="' + id + '" value="Add to Cart"/></td>';
			catalog += '</tr>';
		});
		catalog += '</table>';
		$("#products").html(catalog);
		
		// Add items to cart when user clicks the AddToCart button.
		$("#products input.button").click(function() {
			$.getJSON("./cart.php?method=addToCart",
			{
				prod_id: this.id,
				count: $("#products select#" + this.id + "_qty").val()
			},
			function(resp) {
				if (resp) {
					$("#msg").html('Item added to cart.');
				}
				else {
					$("#msg").html('Failed to add item to cart.');
				}
			});
		});
	});
</script>
</head>
<body>
	<h1>Store</h1>
	<p>Welcome <span class="user_id"></span> to our store. (<a href="./logout.html">If you're not <span class="user_id"></span>, click here to logout</a>)</p>
	<h2>Products</h2>
	<div id="products"></div>
	<div id="msg"></div>
	<form action="./checkout.html">
		<input type="submit" value="Proceed to Checkout"/>
	</form>
</body>
</html>